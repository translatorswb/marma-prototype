<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive UI Prototype</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="top-panel">
        <!-- Marma alphabet buttons -->
        <div class="alphabet-buttons">
            <script>
                const marmaAlphabet = 'ဆတနမအပကငသစဟဩ၏ဈဝဣဌဤဩ၌ဥ၍ဏဧဗဒဓဂဎဖထခလဘညယဇဌဃဠယဉရ';
                marmaAlphabet.split('').forEach(letter => {
                    document.write(`<button onclick="appendLetter('${letter}')">${letter}</button>`);
                });
            </script>
        </div>

        <!-- Diacritic marks buttons -->
        <div class="diacritic-buttons">
            <script>
                const diacriticMarks = 'ါာိီုူေဲံ့း္်ျြွှ';
                diacriticMarks.split('').forEach(mark => {
                    document.write(`<button class="diacritic" onclick="appendDiacritic('${mark}')">${mark}</button>`);
                });

                function appendLetter(letter) {
                    document.getElementById('text-box').value += letter;
                }

                function appendDiacritic(mark) {
                    const textBox = document.getElementById('text-box');
                    if (textBox.value) {
                        textBox.value += mark;
                    } else {
                        textBox.value += mark;
                    }
                }
            </script>
        </div>
    </div>

    <div class="text-box-container">
        <input type="text" id="text-box" placeholder="Text will appear here">
        <button class="delete-button" onclick="clearTextBox()">
            <i class="fa-solid fa-delete-left"></i>
        </button>
        <button class="play-button" onclick="alert('Playing: ' + document.getElementById('text-box').value)">
            <i class="fas fa-play"></i>
        </button>
    </div>

    <!-- Tabbed interface -->
    <div class="tabs">
        <button id="tab-button-1" class="tab-button active" onclick="showTabContent('tab1', 'content/content1')">Content 1</button>
        <button id="tab-button-2" class="tab-button" onclick="showTabContent('tab2', 'content/content2')">Content 2</button>
    </div>

    <button class="large-play-button" onclick="playAllSentences()">
        <i class="fa-regular fa-circle-play"></i> Play All
    </button>

    <div id="tab1" class="tab-content active">
        <div class="sentences-box" id="sentences-box-tab1">
            <!-- Sentence containers will be populated here by JavaScript -->
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <div class="sentences-box" id="sentences-box-tab2">
            <!-- Sentence containers will be populated here by JavaScript -->
        </div>
    </div>

    <script>
        function loadWord(word) {
            document.getElementById('text-box').value = word;
        }

        function clearTextBox() {
            document.getElementById('text-box').value = '';
        }

        function splitWords(event) {
            const target = event.target;
            // Check if the sentence is already split
            if (target.getAttribute('data-split') === 'true') return;

            const sentence = target.innerText.trim().split(/\s+/); // Split by whitespace and trim extra spaces
            console.log("Original sentence:", target.innerText);
            console.log("Split words:", sentence);

            target.innerHTML = '';
            sentence.forEach((word, index) => {
                const wordSpan = document.createElement('span');
                wordSpan.innerText = word;
                wordSpan.style.cursor = 'pointer';
                wordSpan.onclick = () => loadWord(word);
                target.appendChild(wordSpan);
                if (index < sentence.length - 1) {
                    target.appendChild(document.createTextNode(' ')); // Add a space between words
                }
            });

            // Mark the sentence as split to prevent re-splitting
            target.setAttribute('data-split', 'true');
        }

        function playAllSentences() {
            const audio = new Audio(currentContent.fullAudio);
            audio.play();
        }

        function showTabContent(tabId, contentDir) {
            const tabs = document.getElementsByClassName('tab-button');
            const contents = document.getElementsByClassName('tab-content');

            for (let tab of tabs) {
                tab.classList.remove('active');
            }
            for (let content of contents) {
                content.classList.remove('active');
            }

            document.querySelector(`.tab-button[onclick="showTabContent('${tabId}', '${contentDir}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            loadContent(contentDir, `sentences-box-${tabId}`, tabId);
        }

        async function loadContent(contentDir, boxId, tabId) {
            try {
                const titleResponse = await fetch(`${contentDir}/title.txt`);
                const titleText = await titleResponse.text();
                document.querySelector(`#tab-button-${tabId.slice(-1)}`).innerText = titleText.trim();

                const contentResponse = await fetch(`${contentDir}/content.txt`);
                const contentText = await contentResponse.text();

                const segments = [];
                for (let i = 1; i <= contentText.trim().split('\n').length; i++) {
                    segments.push(`${contentDir}/segments/${i}.mp3`);
                }

                const fullAudio = `${contentDir}/full_audio.mp3`;

                updateUI(contentText.trim().split('\n'), segments, fullAudio, boxId);
            } catch (error) {
                console.error('Error loading content:', error);
                document.getElementById(boxId).innerHTML = '<p>Error loading content. Please check the console for more details.</p>';
            }
        }

        async function loadTabTitles() {
            const tab1TitleResponse = await fetch('content/content1/title.txt');
            const tab1TitleText = await tab1TitleResponse.text();
            document.querySelector('#tab-button-1').innerText = tab1TitleText.trim();

            const tab2TitleResponse = await fetch('content/content2/title.txt');
            const tab2TitleText = await tab2TitleResponse.text();
            document.querySelector('#tab-button-2').innerText = tab2TitleText.trim();
        }

        function updateUI(contentLines, segments, fullAudio, boxId) {
            const sentencesBox = document.getElementById(boxId);
            sentencesBox.innerHTML = '';

            contentLines.forEach((line, index) => {
                const sentenceContainer = document.createElement('div');
                sentenceContainer.className = 'sentence-container';

                const sentenceDiv = document.createElement('div');
                sentenceDiv.innerText = line.trim();
                sentenceDiv.onclick = (event) => splitWords(event);
                sentenceContainer.appendChild(sentenceDiv);

                const playButton = document.createElement('button');
                playButton.className = 'sentence-play-button';
                playButton.innerHTML = '<i class="fas fa-play"></i>';
                playButton.onclick = () => {
                    const audio = new Audio(segments[index]);
                    audio.play();
                };
                sentenceContainer.appendChild(playButton);

                sentencesBox.appendChild(sentenceContainer);
            });

            currentContent = { contentLines, segments, fullAudio };
        }

        let currentContent = {
            contentLines: [],
            segments: [],
            fullAudio: ''
        };

        window.onload = async () => {
            await loadTabTitles(); // Load the titles for both tabs
            showTabContent('tab1', 'content/content1'); // Display the first tab content
        };
    </script>
</body>
</html>